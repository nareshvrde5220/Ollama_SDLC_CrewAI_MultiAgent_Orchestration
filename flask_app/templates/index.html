{% extends "base.html" %}
{% block title %}New Pipeline — SDLC Dashboard{% endblock %}

{% block extra_styles %}
.hero-section {
    text-align: center;
    padding: 2rem 0 2.5rem;
}

.hero-section h1 {
    font-size: 2.5rem;
    font-weight: 900;
    letter-spacing: -0.04em;
    background: var(--gradient-1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.75rem;
}

.hero-section p {
    color: var(--text-muted);
    font-size: 1.05rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.agent-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
    margin-top: 1rem;
}

.agent-chip {
    background: var(--bg-glass);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.25s;
}

.agent-chip:hover {
    border-color: var(--border-active);
    background: var(--bg-glass-hover);
}

.agent-chip .dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

.agent-chip .info {
    min-width: 0;
}

.agent-chip .role {
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--text-primary);
}

.agent-chip .model {
    font-size: 0.72rem;
    color: var(--text-muted);
    font-family: var(--mono);
}

.form-card {
    max-width: 800px;
    margin: 0 auto;
}

.sample-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 0.75rem;
}

.sample-chip {
    background: var(--bg-glass);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 6px 14px;
    font-size: 0.78rem;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}

.sample-chip:hover {
    background: rgba(99,102,241,0.1);
    border-color: var(--accent);
    color: #a5b4fc;
}

.stats-row {
    display: flex;
    justify-content: center;
    gap: 3rem;
    margin-top: 1.5rem;
}

.stat {
    text-align: center;
}

.stat .num {
    font-size: 1.8rem;
    font-weight: 800;
    background: var(--gradient-2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat .label {
    font-size: 0.78rem;
    color: var(--text-muted);
    margin-top: 2px;
}
{% endblock %}

{% block content %}
<section class="hero-section">
    <h1><i class="fas fa-microchip"></i> SDLC Pipeline</h1>
    <p>Multi-agent software development powered by CrewAI + Ollama. 7 AI agents collaborate through the full SDLC — 100% local on RTX 4090.</p>

    <div class="stats-row">
        <div class="stat">
            <div class="num">7</div>
            <div class="label">AI Agents</div>
        </div>
        <div class="stat">
            <div class="num">3</div>
            <div class="label">LLM Models</div>
        </div>
        <div class="stat">
            <div class="num">9</div>
            <div class="label">Output Files</div>
        </div>
    </div>
</section>

<!-- Agent Overview -->
<div class="card" style="margin-bottom: 1.5rem;">
    <div class="card-header">
        <div class="card-title"><i class="fas fa-users"></i> Agent Fleet</div>
    </div>
    <div class="agent-grid">
        {% set colors = ['#6366f1','#8b5cf6','#a855f7','#d946ef','#ec4899','#f43f5e','#f97316'] %}
        {% for a in agents %}
        <div class="agent-chip">
            <div class="dot" style="background: {{ colors[loop.index0 % 7] }};"></div>
            <div class="info">
                <div class="role">{{ a.role }}</div>
                <div class="model">{{ a.model }}</div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Pipeline Form -->
<div class="card form-card">
    <div class="card-header">
        <div class="card-title"><i class="fas fa-rocket"></i> Launch New Pipeline</div>
    </div>
    <form id="pipelineForm">
        <div class="form-group">
            <label class="form-label">Software Requirement</label>
            <textarea class="form-textarea" id="requirement" placeholder="Describe the software you want to build...&#10;&#10;e.g., Build a REST API for a task management system with user authentication, CRUD operations, and SQLite database"></textarea>
        </div>
        <div class="form-group">
            <label class="form-label" style="font-size:0.78rem; color: var(--text-muted);">Quick Templates</label>
            <div class="sample-chips">
                <div class="sample-chip" onclick="useSample(this)">Todo List App with CRUD</div>
                <div class="sample-chip" onclick="useSample(this)">REST API with JWT Auth</div>
                <div class="sample-chip" onclick="useSample(this)">CLI File Organizer Tool</div>
                <div class="sample-chip" onclick="useSample(this)">Weather Dashboard with API</div>
                <div class="sample-chip" onclick="useSample(this)">Chat Application with WebSocket</div>
                <div class="sample-chip" onclick="useSample(this)">Inventory Management System</div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary" id="submitBtn" style="width:100%;">
            <i class="fas fa-play"></i> Start SDLC Pipeline
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
const samples = {
    'Todo List App with CRUD': 'Build a todo list application with add, remove, mark complete, and list tasks functionality. Include data persistence with JSON file storage, input validation, and a clean CLI interface.',
    'REST API with JWT Auth': 'Build a REST API for user management with JWT authentication, registration, login, profile CRUD operations, and SQLite database. Include rate limiting and input validation.',
    'CLI File Organizer Tool': 'Build a command-line file organizer tool that sorts files in a directory by type (images, documents, videos, etc.) into organized subfolders. Support undo operations and dry-run mode.',
    'Weather Dashboard with API': 'Build a weather dashboard application that fetches data from OpenWeatherMap API, displays current weather and 5-day forecast, supports multiple cities, and caches results.',
    'Chat Application with WebSocket': 'Build a real-time chat application using WebSockets with support for multiple rooms, user nicknames, message history, and typing indicators.',
    'Inventory Management System': 'Build an inventory management system with product CRUD, stock tracking, low-stock alerts, search/filter functionality, and CSV import/export.',
};

function useSample(el) {
    const key = el.textContent;
    document.getElementById('requirement').value = samples[key] || key;
    document.getElementById('requirement').focus();
}

document.getElementById('pipelineForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const req = document.getElementById('requirement').value.trim();
    if (!req) { showToast('Please enter a requirement'); return; }

    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.innerHTML = '<div class="spinner"></div> Starting Pipeline...';

    try {
        const resp = await fetch('/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ requirement: req }),
        });
        const data = await resp.json();
        if (data.error) {
            showToast(data.error);
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-play"></i> Start SDLC Pipeline';
            return;
        }
        // Redirect to live tracking page
        window.location.href = `/live/${data.run_id}`;
    } catch (err) {
        showToast('Failed to start pipeline');
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-play"></i> Start SDLC Pipeline';
    }
});
</script>
{% endblock %}
